<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #1a1a2e;
            font-family: 'Inter', sans-serif;
        }
        .slot-reel {
            background-color: #2c2c54;
            border: 2px solid #40407a;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease-out;
        }
        .slot-symbol {
            font-size: 3rem;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .play-button {
            background: linear-gradient(180deg, #ff6b6b 0%, #ee5253 100%);
            transition: background 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .play-button:hover:not(:disabled) { background: linear-gradient(180deg, #ee5253 0%, #ff6b6b 100%); }
        .play-button:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2); }
        .play-button:disabled { background: #999; cursor: not-allowed; opacity: 0.7; box-shadow: none; }

         .bonus-button { /* –ö–Ω–æ–ø–∫–∞ "–ó–∞–±—Ä–∞—Ç—å –ë–æ–Ω—É—Å" */
            background: linear-gradient(180deg, #feca57 0%, #ff9f43 100%);
            transition: background 0.3s ease, transform 0.1s ease, opacity 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            color: #333; /* –¢–µ–º–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
        }
        .bonus-button:hover:not(:disabled) { background: linear-gradient(180deg, #ff9f43 0%, #feca57 100%); }
        .bonus-button:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2); }
         /* –°—Ç–∏–ª—å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ "–ó–∞–±—Ä–∞—Ç—å –ë–æ–Ω—É—Å" */
        .bonus-button:disabled {
            background: #a0a0a0; /* –°–µ—Ä—ã–π —Ñ–æ–Ω */
            color: #666; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }
        @keyframes spin {
            0% { transform: translateY(-15px); opacity: 0.5; }
            50% { transform: translateY(15px); opacity: 0.5; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .spinning { animation: spin 0.2s linear 3; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900">
    <div class="bg-gray-800 p-8 rounded-lg shadow-xl text-center max-w-md w-full">
        <h1 id="attempts-text" class="text-2xl font-bold text-yellow-400 mb-6">–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: 3</h1>

        <div class="flex justify-center space-x-4 mb-8">
            <div id="slot1" class="slot-reel w-20 h-24 rounded-md flex items-center justify-center">
                <span class="slot-symbol">‚ùì</span>
            </div>
            <div id="slot2" class="slot-reel w-20 h-24 rounded-md flex items-center justify-center">
                <span class="slot-symbol">‚ùì</span>
            </div>
            <div id="slot3" class="slot-reel w-20 h-24 rounded-md flex items-center justify-center">
                <span class="slot-symbol">‚ùì</span>
            </div>
        </div>

        <button id="play-button" class="play-button text-white font-bold py-3 px-8 rounded-lg text-xl w-full mb-4">
            –ò–ì–†–ê–¢–¨
        </button>

        <p id="message" class="text-gray-300 mb-4 min-h-[3rem]"></p> <a href="#" target="_blank" id="bonus-button-link" class="hidden">
             <button id="bonus-button" class="bonus-button text-gray-800 font-bold py-3 px-8 rounded-lg text-xl w-full">
                –ó–ê–ë–†–ê–¢–¨ –ë–û–ù–£–°
             </button>
        </a>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const attemptsText = document.getElementById('attempts-text');
        const playButton = document.getElementById('play-button');
        const bonusButtonLink = document.getElementById('bonus-button-link'); // –°—Å—ã–ª–∫–∞ <a>
        const bonusButtonElement = document.getElementById('bonus-button'); // –ö–Ω–æ–ø–∫–∞ <button>
        const message = document.getElementById('message');
        const slots = [
            document.getElementById('slot1').querySelector('.slot-symbol'),
            document.getElementById('slot2').querySelector('.slot-symbol'),
            document.getElementById('slot3').querySelector('.slot-symbol')
        ];
        const slotReels = [
            document.getElementById('slot1'),
            document.getElementById('slot2'),
            document.getElementById('slot3')
        ];

        // --- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –±–æ—Ç–∞ –∏–∑ URL ---
        const urlParams = new URLSearchParams(window.location.search);
        const botUsernameFromUrl = urlParams.get('bot');
        const defaultBotUsername = 'testbot1winbot'; // –ë–æ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const botUsername = botUsernameFromUrl || defaultBotUsername;
        const startParam = '3'; // –ü–∞—Ä–∞–º–µ—Ç—Ä start –¥–ª—è —ç—Ç–æ–π —Ä—É–ª–µ—Ç–∫–∏
        console.log(`–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –±–æ—Ç: ${botUsername}, startParam: ${startParam}`);
        // --- –ö–æ–Ω–µ—Ü –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –±–æ—Ç–∞ ---

        // –°–∏–º–≤–æ–ª—ã
        const symbols = ['üçí', 'üçä', 'üçã', 'üçâ', '‚≠ê', 'üîî'];
        const winningSymbol = 'üîî'; // –í—ã–∏–≥—Ä—ã—à–Ω—ã–π —Å–∏–º–≤–æ–ª

        // –ö–ª—é—á–∏ localStorage
        const localStorageKeyAttempts = 'slotAttempts_v1';
        const localStorageKeyClaim = 'slotBonusClaimed_v1';

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let attemptsLeft;
        let isSpinning = false;
        let bonusClaimed = false; // –§–ª–∞–≥ –Ω–∞–∂–∞—Ç–∏—è –±–æ–Ω—É—Å–Ω–æ–π –∫–Ω–æ–ø–∫–∏

        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function initializeGame() {
            const savedAttempts = localStorage.getItem(localStorageKeyAttempts);
            const savedClaimState = localStorage.getItem(localStorageKeyClaim);

            bonusClaimed = savedClaimState === 'true';

            if (savedAttempts !== null && !isNaN(parseInt(savedAttempts))) {
                 attemptsLeft = parseInt(savedAttempts, 10);
            } else {
                // –°–≤–µ–∂–∏–π —Å—Ç–∞—Ä—Ç
                attemptsLeft = 3;
                bonusClaimed = false;
                localStorage.setItem(localStorageKeyAttempts, attemptsLeft);
                localStorage.removeItem(localStorageKeyClaim);
            }

            updateAttemptsDisplay();

            if (attemptsLeft <= 0) {
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ —É–∂–µ –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (0 –ø–æ–ø—ã—Ç–æ–∫)
                showResult([winningSymbol, winningSymbol, winningSymbol], bonusClaimed); // –ü–µ—Ä–µ–¥–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥
                playButton.disabled = true;

                // –°—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–ª–∞–≥–∞
                if (bonusClaimed) {
                     message.innerHTML = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 70FS!<br>–ó–∞ –≤—ã–∏–≥—Ä—ã—à–µ–º –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞.'; // –°—Ä–∞–∑—É –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å <br>
                     bonusButtonElement.disabled = true;
                } else {
                     message.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 70FS!'; // –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å
                     bonusButtonElement.disabled = false;
                }

            } else {
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
                message.textContent = `–£ –≤–∞—Å –µ—Å—Ç—å ${attemptsLeft} –ø–æ–ø—ã—Ç–∫–∏. –ù–∞–∂–º–∏—Ç–µ ¬´–ò–≥—Ä–∞—Ç—å¬ª!`;
                playButton.disabled = false;
                bonusButtonLink.classList.add('hidden');
                bonusButtonElement.disabled = false;
                slots.forEach(slot => slot.textContent = '‚ùì');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫
        function updateAttemptsDisplay() {
            attemptsText.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attemptsLeft}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ (–Ω–µ –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ)
        function getRandomSymbol() {
             return symbols[Math.floor(Math.random() * symbols.length)];
        }

        // –§—É–Ω–∫—Ü–∏—è "–≤—Ä–∞—â–µ–Ω–∏—è" –±–∞—Ä–∞–±–∞–Ω–æ–≤
        function spinReels(finalResult) {
            isSpinning = true;
            playButton.disabled = true;
            message.textContent = '–í—Ä–∞—â–∞–µ–º...';
            bonusButtonLink.classList.add('hidden');

            slotReels.forEach(reel => reel.classList.add('spinning'));

            let spinInterval = setInterval(() => {
                 slots.forEach(slot => slot.textContent = getRandomSymbol());
            }, 50);

            setTimeout(() => {
                 clearInterval(spinInterval);
                 slotReels.forEach(reel => reel.classList.remove('spinning'));
                 // –ü–µ—Ä–µ–¥–∞–µ–º false, —Ç.–∫. –±–æ–Ω—É—Å —Ç–æ—á–Ω–æ –µ—â–µ –Ω–µ –∑–∞–±—Ä–∞–Ω –≤ –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–ø–∏–Ω–∞
                 showResult(finalResult, false);
                 isSpinning = false;
            }, 600);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–ø–∏–Ω–∞
        function showResult(result, isBonusAlreadyClaimed) {
            slots.forEach((slot, index) => {
                slot.textContent = result[index];
            });

            if (attemptsLeft <= 0) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ
                message.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ 70FS!';
                playButton.disabled = true;

                const telegramLink = `https://t.me/${botUsername}?start=${startParam}`;
                bonusButtonLink.href = telegramLink;
                bonusButtonLink.classList.remove('hidden');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –±—ã–ª –ª–∏ –±–æ–Ω—É—Å —É–∂–µ –∑–∞–±—Ä–∞–Ω —Ä–∞–Ω–µ–µ
                bonusButtonElement.disabled = isBonusAlreadyClaimed;

            } else {
                 message.textContent = '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!';
                 playButton.disabled = false;
                 bonusButtonLink.classList.add('hidden');
            }
            updateAttemptsDisplay();
        }


        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ò–≥—Ä–∞—Ç—å"
        playButton.addEventListener('click', () => {
            if (isSpinning || attemptsLeft <= 0) return;

            attemptsLeft--;
            localStorage.setItem(localStorageKeyAttempts, attemptsLeft);
            updateAttemptsDisplay();

            let result;
            if (attemptsLeft === 0) {
                result = [winningSymbol, winningSymbol, winningSymbol];
            } else {
                do {
                    result = [getRandomSymbol(), getRandomSymbol(), getRandomSymbol()];
                } while (result.every(symbol => symbol === winningSymbol));
            }
            spinReels(result);
        });

         // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–ê–ë–†–ê–¢–¨ –ë–û–ù–£–°"
        bonusButtonElement.addEventListener('click', () => {
            // –ù–µ –¥–µ–ª–∞—Ç—å –Ω–∏—á–µ–≥–æ, –µ—Å–ª–∏ —É–∂–µ –Ω–∞–∂–∞—Ç–∞ –ò–õ–ò –µ—Å–ª–∏ –∏–≥—Ä–∞ –µ—â–µ –Ω–µ –∑–∞–∫–æ–Ω—á–µ–Ω–∞ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
            if (bonusClaimed || attemptsLeft > 0) return;

            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
            message.innerHTML += '<br>–ó–∞ –≤—ã–∏–≥—Ä—ã—à–µ–º –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞.';

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            bonusButtonElement.disabled = true;
            bonusClaimed = true;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–∏
            localStorage.setItem(localStorageKeyClaim, bonusClaimed);
        });


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        initializeGame();

    </script>

</body>
</html>
